{% extends "base.html" %}

{% block title %}用户信息-{{ web.name }}{% endblock title %}

{% block head %}
{{ super() }}
<link href="/static/css/viewer.min.css" rel="stylesheet" />
<script src="/static/js/viewer.min.js"></script>
<script src="/static/js/arttemplate.js"></script>
<style>
    .title {
    color: #222831;
    text-decoration-line:none;
}
    .title:hover {
        color:#f38181;
        cursor:default;
    }
</style>
{% endblock head %}

{% block nav %}
{% include "component/nav.html" %}
{% endblock nav %}

{% block main %}
<div class="vstack" style="border-bottom:solid 1px #e1e1e1;padding-bottom:5px;margin-bottom:15px;">
    <div style="width:100%;height:332px;position:relative;">
        <img src="{{ info.background }}" style="width:100%;height:100%;object-fit:cover;" id="bg1" onclick="look(this)">
        <img src="{{ info.avatar }}"
             id="avatar1"
             onclick="look(this)"
             style="width:100px;height:100px;border-radius:50px;border:solid 2px white;position:absolute;bottom:-50px;left:30px;">
    </div>
    <div>
        <div style="margin-left:140px;margin-top:7px;">
            <p style="font-size:18px;font-weight:bold;">{{ info.username }}</p>
            {% if user.signature %}
            <p>{{ info.signature }}</p>
            {% else %}
            <p>什么都没有写~</p>
            {% endif %}
            <p style="font-size:14px;color:#519872;">
                最近登录: {{ moment(time=info.logined) }}
            </p>
        </div>

    </div>
    {% if user %}
    {% if user.id == info.id %}
    <div style="width: 100%;position: relative;height: 30px;margin-top: 20px;display: flex;justify-content: flex-end;">
        <a class="button is-text is-small" href="/user/edit_info"
           style="font-size: 14px;color: black;margin-right: 7px;">编辑资料</a>
        <a class="button is-text is-small" href="/user/edit_pwd"
           style="font-size: 14px;color: black;">更改密码</a>
    </div>
    {% endif %}
    {% endif %}
</div>

<div>
    <div>
        <p>全部文章(2)</p>
    </div>
    <div >
        <ul class="list-group list-group-flush" id="posts">

        </ul>
    </div>
</div>
{% endblock main %}



{% block script %}
{% include "template/post_item.html" %}
<script type="text/javascript">
    function look(elem) {
        console.log(window.location.pathname)
        const viewer = new Viewer(document.getElementById(elem.id), {
            inline: false,
            toolbar: false,
            navbar: false,
            hide: function() {
                viewer.destroy();
            }
        });
        viewer.show();
    }
    (function (){
            let id = window.location.pathname.split('/').at(-1);
           axios({
            method: 'post',
            url: `/post/list/${id}`,
            data: {
                page: 1,
            }
        }).then(res => {
            if (res.data.code == 200) {
               console.log(res.data);
               let html = template('tpl-post-list', res.data);
                let b = document.getElementById('posts');
                b.innerHTML = html;
            } else {
                Qmsg.warning(res.data.msg, {
                    timeout: 3000
                });
            }
        })
    })();


</script>
{% endblock script %}