{% extends "base.html" %}

{% block title %}{{ web.name }}{% endblock title %}

{% block head %}
{{ super() }}
{% endblock head %}

{% block nav %}
{% include "component/nav.html" %}
{% endblock nav %}

{% block main %}
<div class="card" style="margin-top: 50px;">
    <div class="card-content">
        <div class="content">

            <div class="field">
                <label class="label">头像</label>
                <div class="control">
                    <input class="input" type="text" placeholder="url链接" value="{{ info.avatar }}" id="avatar">
                </div>
                <div class="file is-info">
                    <label class="file-label">
                        <input class="file-input" type="file" name="resume">
                        <span class="file-cta">
                            <span class="file-icon">
                                <i class="fas fa-upload"></i>
                            </span>
                            <span class="file-label">
                            上传头像
                            </span>
                        </span>
                    </label>
                </div>
            </div>

            <div class="field">
                <label class="label">背景</label>
                <div class="control">
                    <input class="input" type="text" placeholder="url链接" value="{{ info.background }}"
                           id="background">
                </div>
                <div class="file is-info">
                    <label class="file-label">
                        <input class="file-input" type="file" name="resume">
                        <span class="file-cta">
                            <span class="file-icon">
                                <i class="fas fa-upload"></i>
                            </span>
                            <span class="file-label">
                            上传背景
                            </span>
                        </span>
                    </label>
                </div>
            </div>

            <div class="field">
                <label class="label">昵称</label>
                <div class="control">
                    <input class="input" type="text" placeholder="2-20位" value="{{ info.username }}" id="username">
                </div>
            </div>

            <div class="field">
                <label class="label">签名</label>
                <div class="control">
                    <input class="input" type="text" placeholder="个性签名(50字以内)" value="{{ info.signature }}"
                           id="signature">
                </div>
            </div>

            <div style="margin-top: 20px;">
                <button class="button is-success" onclick="update_info()">更改</button>
            </div>

        </div>

    </div>
</div>
{% endblock main %}


{% block script %}
<script type="text/javascript">
    function update_info() {
        let avatar = document.getElementById("avatar").value;
        let background = document.getElementById("background").value;
        let username = document.getElementById("username").value;
        let signature = document.getElementById("signature").value;
        axios({
            method: 'post',
            url: '/user/edit/info',
            data: {
                avatar: avatar!=''?avatar:null,
                background: background!=''?background:null,
                username: username,
                signature: signature
            }
        }).then( res => {
            console.log(res)
            if (res.data.code == 200) {
                Qmsg.success(res.data.msg, {
                    timeout: 3000
                });
            }
            if (res.data.code == 410) {
                Qmsg.warning(res.data.msg, {
                    timeout: 3000
                });
            }
        })
    }

</script>
{% endblock script %}